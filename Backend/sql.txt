create table user( 
user_id int not null auto_increment, 
email varchar(225) not null, 
name varchar(225) not null, 
password varchar(225) not null, 
type ENUM('Admin', 'Customer'),
registration_date timestamp default current_timestamp, 
PRIMARY KEY (user_id) 
);

-- 1.Publisher
USE bookstore;
CREATE TABLE PUBLISHER(
pub_id int not null auto_increment, 
name varchar(225) not null, 
address varchar(225) not null,
phone varchar(20),
PRIMARY KEY (pub_id) 
);
-- 2.Author 
USE bookstore;
CREATE TABLE AUTHOR(
author_id int not null auto_increment PRIMARY KEY, 
name varchar(225) not null);
-- 3.Book
USE bookstore;
CREATE TABLE BOOK(
book_isbn varchar(13) not null, 
title varchar(225) not null, 
pub_id int not null,
pub_year year not null,
selling_price decimal(10,2) not null, 
category ENUM('Science', 'Art', 'Religion', 'History', 'Geography') NOT NULL, 
PRIMARY KEY (book_isbn), 
FOREIGN KEY(pub_id) REFERENCES PUBLISHER(pub_id)
on delete RESTRICT ON UPDATE CASCADE,
    INDEX idx_title (title),
    INDEX idx_category (category)
);
-- 4. Many-to-many: Book â†” Author
CREATE TABLE Book_Author (
    book_isbn       VARCHAR(13),
    author_id  INT,
    PRIMARY KEY (book_isbn, author_id),
    FOREIGN KEY (book_isbn)      REFERENCES Book(book_isbn)
        ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (author_id) REFERENCES Author(author_id)
        ON DELETE CASCADE ON UPDATE CASCADE
);

-- 5. Orders from publishers (purchase orders to restock books)
CREATE TABLE Publisher_Order (
    order_id         INT AUTO_INCREMENT PRIMARY KEY,
    pub_id     INT NOT NULL,
    order_date       DATE NOT NULL DEFAULT (CURRENT_DATE),
    expected_delivery_date DATE,
    total_amount     DECIMAL(12,2),
    status           ENUM('Pending', 'Shipped', 'Received', 'Cancelled') DEFAULT 'Pending',
  FOREIGN KEY (pub_id) REFERENCES Publisher(pub_id)
);

-- 6. Order items (which books and how many in each order)
CREATE TABLE Publisher_Order_Item (
    order_id     INT,
    isbn         VARCHAR(13),
    quantity     INT NOT NULL CHECK (quantity > 0),
    unit_cost    DECIMAL(10,2) NOT NULL,   -- cost price from publisher
    PRIMARY KEY (order_id, isbn),
    FOREIGN KEY (order_id) REFERENCES Publisher_Order(order_id)
    ON DELETE CASCADE,
    FOREIGN KEY (isbn)      REFERENCES Book(isbn)
        ON DELETE RESTRICT
);
